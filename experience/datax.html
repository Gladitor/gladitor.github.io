<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>DataX --alibaba | Jiay</title>
    <meta name="description" content="welcome!">
    <link rel="icon" href="/myblog/favicon.ico">
    
    <link rel="preload" href="/myblog/assets/css/0.styles.a938fca8.css" as="style"><link rel="preload" href="/myblog/assets/js/app.ea8ac135.js" as="script"><link rel="preload" href="/myblog/assets/js/2.d117081b.js" as="script"><link rel="preload" href="/myblog/assets/js/12.35df9b6e.js" as="script"><link rel="preload" href="/myblog/assets/js/11.88fd6eb4.js" as="script"><link rel="prefetch" href="/myblog/assets/js/10.e0b8d3b8.js"><link rel="prefetch" href="/myblog/assets/js/13.03173943.js"><link rel="prefetch" href="/myblog/assets/js/14.77b392dd.js"><link rel="prefetch" href="/myblog/assets/js/15.8dae48bc.js"><link rel="prefetch" href="/myblog/assets/js/16.f74b3a18.js"><link rel="prefetch" href="/myblog/assets/js/17.8b919cbf.js"><link rel="prefetch" href="/myblog/assets/js/18.d0e83ae3.js"><link rel="prefetch" href="/myblog/assets/js/19.c5ad8663.js"><link rel="prefetch" href="/myblog/assets/js/20.f685b26a.js"><link rel="prefetch" href="/myblog/assets/js/21.ef13f21e.js"><link rel="prefetch" href="/myblog/assets/js/22.5eb420cc.js"><link rel="prefetch" href="/myblog/assets/js/23.d950a0ed.js"><link rel="prefetch" href="/myblog/assets/js/24.8a1641dc.js"><link rel="prefetch" href="/myblog/assets/js/25.4ac09209.js"><link rel="prefetch" href="/myblog/assets/js/26.df98142a.js"><link rel="prefetch" href="/myblog/assets/js/27.555684a2.js"><link rel="prefetch" href="/myblog/assets/js/28.70634b4d.js"><link rel="prefetch" href="/myblog/assets/js/29.e7819932.js"><link rel="prefetch" href="/myblog/assets/js/3.f5c5413c.js"><link rel="prefetch" href="/myblog/assets/js/30.d5315beb.js"><link rel="prefetch" href="/myblog/assets/js/4.73fa913d.js"><link rel="prefetch" href="/myblog/assets/js/5.a6e2f20b.js"><link rel="prefetch" href="/myblog/assets/js/6.51872705.js"><link rel="prefetch" href="/myblog/assets/js/7.e01e8977.js"><link rel="prefetch" href="/myblog/assets/js/8.3cc27e7f.js"><link rel="prefetch" href="/myblog/assets/js/9.65c9489f.js">
    <link rel="stylesheet" href="/myblog/assets/css/0.styles.a938fca8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/myblog/" class="home-link router-link-active"><!----> <span class="site-name">Jiay</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myblog/about/" class="sidebar-link">about</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>iot</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>experience</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myblog/experience/" class="sidebar-link">something funny</a></li><li><a href="/myblog/experience/datax.html" class="active sidebar-link">DataX --alibaba</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/experience/datax.html#简介" class="sidebar-link">简介</a></li><li class="sidebar-sub-header"><a href="/myblog/experience/datax.html#datax" class="sidebar-link">datax</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/experience/datax.html#环境配置" class="sidebar-link">环境配置</a></li><li class="sidebar-sub-header"><a href="/myblog/experience/datax.html#datax打包" class="sidebar-link">datax打包</a></li><li class="sidebar-sub-header"><a href="/myblog/experience/datax.html#mysql-sqlserver" class="sidebar-link">MySQL-&gt;SQLSERVER</a></li><li class="sidebar-sub-header"><a href="/myblog/experience/datax.html#sqlserver-sqlserver" class="sidebar-link">SQLSERVER-&gt;SQLSERVER</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/experience/datax.html#crontab" class="sidebar-link">crontab</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/experience/datax.html#环境配置-2" class="sidebar-link">环境配置</a></li><li class="sidebar-sub-header"><a href="/myblog/experience/datax.html#crontab配置" class="sidebar-link">crontab配置</a></li></ul></li></ul></li><li><a href="/myblog/experience/springboot-swagger2.html" class="sidebar-link">springboot-shiro项目集成swagger2</a></li><li><a href="/myblog/experience/gRPC.html" class="sidebar-link">gRPC实战总结</a></li><li><a href="/myblog/experience/fiddler-nox.html" class="sidebar-link">fiddler+nox对android抓包实战</a></li><li><a href="/myblog/experience/xxnet.html" class="sidebar-link">xx-net科学上网教程</a></li><li><a href="/myblog/experience/webservice.html" class="sidebar-link">Cxf实现webservice实战入门</a></li><li><a href="/myblog/experience/liquibase.html" class="sidebar-link">liquibase实战</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>etd</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>issues</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>read</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="datax-alibaba"><a href="#datax-alibaba" aria-hidden="true" class="header-anchor">#</a> DataX --alibaba</h1> <h2 id="简介"><a href="#简介" aria-hidden="true" class="header-anchor">#</a> 简介</h2> <p>DataX是阿里开源ETL工具，全面支持常见数据库，并在阿里广泛使用，详情参考<a href="https://github.com/alibaba/DataX" target="_blank" rel="noopener noreferrer">github地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br>
下面以MySQL-&gt;SQLSERVER,SQLSERVER-&gt;SQLSERVER为例记录datax的基本用法，然后结合crontab实现数据抽取任务。</p> <h2 id="datax"><a href="#datax" aria-hidden="true" class="header-anchor">#</a> datax</h2> <h3 id="环境配置"><a href="#环境配置" aria-hidden="true" class="header-anchor">#</a> 环境配置</h3> <p>datax是java实现，通过python脚本加载json配置文件执行，因此需要JDK1.8和python2.x，这是官方建议的版本。</p> <h3 id="datax打包"><a href="#datax打包" aria-hidden="true" class="header-anchor">#</a> datax打包</h3> <p>从github clone源码到本地，mvn打包:mvn -U clean package assembly:assembly -Dmaven.test.skip=true，本地编译报错无法找到com.aliyun.openservices：tablestore-streamclient：jar：1.0.0-SNAPSHOT，找到osstreamreader的pom.xml，更改如下：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;dependency&gt;
    &lt;groupId&gt;com.aliyun.openservices&lt;/groupId&gt;
    &lt;artifactId&gt;tablestore-streamclient&lt;/artifactId&gt;
    &lt;!--&lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;--&gt;
	&lt;version&gt;1.0.0&lt;/version&gt;
&lt;/dependency&gt;
</code></pre></div><p>mvn -U clean package assembly:assembly -Dmaven.test.skip=true 重新打包</p> <div class="language- extra-class"><pre class="language-text"><code>[INFO] BUILD SUCCESS
[INFO] -----------------------------------------------------------------
[INFO] Total time: 08:12 min
[INFO] Finished at: 2019-04-03T18:05:48+08:00
[INFO] Final Memory: 133M/960M
[INFO] -----------------------------------------------------------------
</code></pre></div><p>也可以从github下载打包好的文件直接使用，github上的包有可能不是最新的。
打包好的文件目录如下<br> <img src="/myblog/assets/img/target.a2287cae.png" alt="target"><br>
bin是python脚本目录，job是任务配置目录，plugin是抽取插件目录。</p> <h3 id="mysql-sqlserver"><a href="#mysql-sqlserver" aria-hidden="true" class="header-anchor">#</a> MySQL-&gt;SQLSERVER</h3> <p>配置文件内容：抽取测试表中数据到目标表</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;job&quot;: {
        &quot;setting&quot;: {
            &quot;speed&quot;: {
			    &quot;byte&quot;:10485760
			}
        },
        &quot;content&quot;: [
            {
                &quot;reader&quot;: {
                    &quot;name&quot;: &quot;mysqlreader&quot;,
                    &quot;parameter&quot;: {
                        &quot;username&quot;: &quot;root&quot;,
                        &quot;password&quot;: &quot;mysql123&quot;,
                        &quot;where&quot;: &quot;&quot;,
                        &quot;connection&quot;: [
                            {
                                &quot;querySql&quot;: [
                                    &quot;select * from db_info_p;&quot;
                                ],
                                &quot;jdbcUrl&quot;: [
                                    &quot;jdbc:mysql://localhost:3306/test&quot;
                                ]
                            }
                        ]
                    }
                },
                &quot;writer&quot;: {
                    &quot;name&quot;: &quot;sqlserverwriter&quot;,
                    &quot;parameter&quot;: {
					    &quot;username&quot;: &quot;sa&quot;,
                        &quot;password&quot;: &quot;sa1&quot;,
						&quot;column&quot;: [
				                    '*'
			                    ],
                        &quot;connection&quot;: [
                            {
                                &quot;table&quot;: [
                                    &quot;db_info_p&quot;
                                ],
                                &quot;jdbcUrl&quot;: &quot;jdbc:sqlserver://192.168.1.151:1000;DatabaseName=FrontMachineTest&quot;
                            }
                        ]
                    }
                }
            }
        ]
    }
}
</code></pre></div><h3 id="sqlserver-sqlserver"><a href="#sqlserver-sqlserver" aria-hidden="true" class="header-anchor">#</a> SQLSERVER-&gt;SQLSERVER</h3> <p>配置文件内容：抽取三个月之前的数据到备份表，删除当前表中相应的数据</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;job&quot;: {
        &quot;setting&quot;: {
            &quot;speed&quot;: {
			    &quot;byte&quot;:10485760
			}
        },
        &quot;content&quot;: [
			{
                &quot;reader&quot;: {
                    &quot;name&quot;: &quot;sqlserverreader&quot;,
                    &quot;parameter&quot;: {
                        &quot;username&quot;: &quot;sa&quot;,
                        &quot;password&quot;: &quot;sa1!&quot;,
                        &quot;where&quot;: &quot;&quot;,
                        &quot;connection&quot;: [
                            {
                                &quot;querySql&quot;: [
                                    &quot;select * from t_gwlssj where sjsj&lt;DATEADD(M,-3,GETDATE());&quot;
                                ],
                                &quot;jdbcUrl&quot;: [
                                    &quot;jdbc:sqlserver://172.16.10.45:1000;DatabaseName=NCYS_GCDB&quot;
                                ]
                            }
                        ]
                    }
                },
                &quot;writer&quot;: {
                    &quot;name&quot;: &quot;sqlserverwriter&quot;,
                    &quot;parameter&quot;: {
					    &quot;username&quot;: &quot;sa&quot;,
                        &quot;password&quot;: &quot;sa1!&quot;,
						&quot;column&quot;: [
				                    '*'
			                    ],
                        &quot;connection&quot;: [
                            {
                                &quot;table&quot;: [
                                    &quot;t_gwlssj_bak&quot;
                                ],
                                &quot;jdbcUrl&quot;: &quot;jdbc:sqlserver://172.16.10.45:1000;DatabaseName=NCYS_GCDB&quot;
                            }
                        ],
						&quot;postSql&quot;: [
                            &quot;delete from t_gwlssj where sjsj&lt;DATEADD(M,-3,GETDATE());&quot;
                        ]
                    }
                }
            }
        ]
    }
}
</code></pre></div><p>注意writer和reader的connection配置是有区别的writer中数据库连接字符串不能配置多个，否则会报出找不到合适驱动的异常信息。<br>
其它datax更详细的配置可参考官网说明。</p> <h2 id="crontab"><a href="#crontab" aria-hidden="true" class="header-anchor">#</a> crontab</h2> <h3 id="环境配置-2"><a href="#环境配置-2" aria-hidden="true" class="header-anchor">#</a> 环境配置</h3> <p>1、下载nircmd，<a href="http://www.nirsoft.net/utils/nircmd.html" target="_blank" rel="noopener noreferrer">下载地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br>
2、安装nircmd，并同意copy到系统目录，若有安全软件风险提醒则需要添加信任。</p> <h3 id="crontab配置"><a href="#crontab配置" aria-hidden="true" class="header-anchor">#</a> crontab配置</h3> <p>1、下载crontab，<a href="https://github.com/qiu8310/crontab" target="_blank" rel="noopener noreferrer">github地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br>
2、更改crontab下bin目录中crontab.bat、crontab_install.bat、crontab_uninstall.bat中crontab的路径。<br>
3、配置任务</p> <div class="language- extra-class"><pre class="language-text"><code># 每隔1天执行一次
* * */1 * * python F:/datax/bin/datax.py F:/datax/job/sclssj_job.json
* * */1 * * python F:/datax/bin/datax.py F:/datax/job/gwlssj_job.json
* * */1 * * python F:/datax/bin/datax.py F:/datax/job/rcgglssj_job.json
</code></pre></div><p>4、安装定时任务<br>
执行crontab_install.bat</p> <p>查看定时任务执行成功，数据抽取成功，大功告成。</p> <div><h2>欢迎来访</h2> <ul><li>有问题欢迎留言或加交流qq群:934022738</li> <li>转载请注明出处</li> <li>请小编喝茶~<br><img src="/myblog/assets/img/wx.dc92fb1a.png"></li></ul></div> <!----></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/myblog/experience/" class="prev router-link-active">
          something funny
        </a></span> <span class="next"><a href="/myblog/experience/springboot-swagger2.html">
          springboot-shiro项目集成swagger2
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/myblog/assets/js/app.ea8ac135.js" defer></script><script src="/myblog/assets/js/2.d117081b.js" defer></script><script src="/myblog/assets/js/12.35df9b6e.js" defer></script><script src="/myblog/assets/js/11.88fd6eb4.js" defer></script>
  </body>
</html>
