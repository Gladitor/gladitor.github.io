(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{113:function(a,e,t){a.exports=t.p+"assets/img/wx.dc92fb1a.png"},252:function(a,e,t){a.exports=t.p+"assets/img/initproject.4e8d5c53.png"},253:function(a,e,t){a.exports=t.p+"assets/img/projectschema.c79f9102.png"},254:function(a,e,t){a.exports=t.p+"assets/img/createtable.f0d4f7a9.png"},255:function(a,e,t){a.exports=t.p+"assets/img/reales.f66bb879.png"},315:function(a,e,t){"use strict";t.r(e);var n=t(2),r=Object(n.a)({},function(){var a=this,e=a.$createElement,n=a._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[n("h1",{attrs:{id:"liquibase实战"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#liquibase实战","aria-hidden":"true"}},[a._v("#")]),a._v(" liquibase实战")]),a._v(" "),n("h2",{attrs:{id:"简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#简介","aria-hidden":"true"}},[a._v("#")]),a._v(" 简介")]),a._v(" "),n("p",[n("a",{attrs:{href:"https://www.liquibase.org/",target:"_blank",rel:"noopener noreferrer"}},[a._v("liquibase"),n("OutboundLink")],1),a._v("是一个用于跟踪、管理和应用数据库变化的开源数据库工具，它将所有数据库的变化保存在xml文件内，方便版本控制，避免开发人员或实施人员手动数据库管理升级等造成的一系列问题。"),n("br"),a._v("\n使用过Microsoft EF6的同学会很清楚这种工具的好处（EF6用在.NET框架中），没用过当我没说过就可以了。")]),a._v(" "),n("h2",{attrs:{id:"初始化项目"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#初始化项目","aria-hidden":"true"}},[a._v("#")]),a._v(" 初始化项目")]),a._v(" "),n("p",[a._v("这里使用一个简单的web项目进行演示。"),n("br"),a._v(" "),n("img",{attrs:{src:t(252),alt:"initproject"}})]),a._v(" "),n("h2",{attrs:{id:"更改配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#更改配置","aria-hidden":"true"}},[a._v("#")]),a._v(" 更改配置")]),a._v(" "),n("ul",[n("li",[a._v("添加依赖")])]),a._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("\x3c!--    日志文件管理包    --\x3e\n        <dependency>\n            <groupId>org.codehaus.janino</groupId>\n            <artifactId>janino</artifactId>\n            <version>${janino.version}</version>\n        </dependency>\n\n        \x3c!--    JDBC    --\x3e\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-jdbc</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>mysql</groupId>\n            <artifactId>mysql-connector-java</artifactId>\n            <scope>runtime</scope>\n        </dependency>\n\n        \x3c!--    Mybatisplus依赖    --\x3e\n        <dependency>\n            <groupId>com.baomidou</groupId>\n            <artifactId>mybatis-plus-boot-starter</artifactId>\n            <version>3.1.1</version>\n        </dependency>\n\n        <dependency>\n            <groupId>org.liquibase</groupId>\n            <artifactId>liquibase-core</artifactId>\n            <version>3.8.1</version>\n        </dependency>\n\n        <dependency>\n            <groupId>org.projectlombok</groupId>\n            <artifactId>lombok</artifactId>\n            <optional>true</optional>\n        </dependency>\n\n        \x3c!-- json --\x3e\n        <dependency>\n            <groupId>com.fasterxml.jackson.core</groupId>\n            <artifactId>jackson-databind</artifactId>\n            <version>2.9.7</version>\n        </dependency>\n")])])]),n("ul",[n("li",[a._v("添加liquibase配置"),n("br"),a._v("\ninit-table.xml数据库建表配置")])]),a._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v('<?xml version="1.1" encoding="UTF-8" standalone="no"?>\n<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:pro="http://www.liquibase.org/xml/ns/pro" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/pro http://www.liquibase.org/xml/ns/pro/liquibase-pro-3.8.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">\n    <changeSet author="JIAY (generated)" id="1574053603125-1">\n        <createTable tableName="user">\n            <column name="Id" type="VARCHAR(36)">\n                <constraints primaryKey="true"/>\n            </column>\n            <column name="Name" type="VARCHAR(50)"/>\n            <column name="Age" type="INT"/>\n        </createTable>\n    </changeSet>\n</databaseChangeLog>\n')])])]),n("p",[a._v("changelog-master.xml数据库重构入口配置")]),a._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v('<?xml version="1.1" encoding="UTF-8" standalone="no"?>\n<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"\n                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd">\n\n    \x3c!--relativeToChangelogFile=true则指changelog文件目录是相对根changelog而不是classpath--\x3e\n    <include file="classpath:liquibase/init-table.xml" relativeToChangelogFile="false"/>\n\n</databaseChangeLog>\n')])])]),n("ul",[n("li",[a._v("添加配置文件")])]),a._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v('spring:\n  profiles:\n    active: dev\n  liquibase:\n    enabled: true\n    change-log: "classpath:/liquibase/changelog-master.xml"\nlogging:\n  level:\n    org:\n      springframework:\n        boot:\n          autoconfigure: ERROR\n')])])]),n("p",[a._v("完整项目结构图"),n("br"),a._v(" "),n("img",{attrs:{src:t(253),alt:"projectschema"}})]),a._v(" "),n("h2",{attrs:{id:"启动项目自动创建user表"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#启动项目自动创建user表","aria-hidden":"true"}},[a._v("#")]),a._v(" 启动项目自动创建user表")]),a._v(" "),n("p",[n("img",{attrs:{src:t(254),alt:"createtable"}}),n("br"),a._v("\n数据库中成功创建了user表。另外两个表是数据库操作记录表。")]),a._v(" "),n("h2",{attrs:{id:"liquibase标签"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#liquibase标签","aria-hidden":"true"}},[a._v("#")]),a._v(" liquibase标签")]),a._v(" "),n("ul",[n("li",[a._v("创建表")])]),a._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v('<changeSet id="3" author="jiay"> \n <createTable tableName="user">\n    <column name="Id" type="VARCHAR(36)">\n        <constraints primaryKey="true"/>\n    </column>\n    <column name="Name" type="VARCHAR(50)"/>\n    <column name="Age" type="INT"/>\n </createTable> \n</changeSet>\n')])])]),n("ul",[n("li",[a._v("添加列")])]),a._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v('<changeSet id="4" author="jiay"> \n <addColumn tableName="user"> \n   <column name="phonenumber" type="varchar(15)"/> \n </addColumn> \n</changeSet>\n')])])]),n("ul",[n("li",[a._v("删除列")])]),a._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v('<changeSet id="5" author="jiay"> \n <dropColumn tableName="user" columnName="phonenumber"/> \n</changeSet>\n')])])]),n("ul",[n("li",[a._v("增加数据")])]),a._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v('<changeSet author="jiay" id="6">\n    <insert tableName="user">\n        <column name="Id" value="dcc0bfd3-09ba-11ea-af01-00ff9adab040"/>\n        <column name="Name" value="jiay"/>\n        <column name="Age" valueNumeric="20"/>\n    </insert>\n</changeSet>\n')])])]),n("ul",[n("li",[a._v("引入sql脚本")])]),a._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v('<changeSet id="7" author="jiay"> \n <sqlFile path="insert-data.sql"/> \n</changeSet>\n')])])]),n("p",[a._v("更多内容查看官方资料"),n("a",{attrs:{href:"https://www.liquibase.org/quickstart.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://www.liquibase.org/quickstart.html"),n("OutboundLink")],1)]),a._v(" "),n("h2",{attrs:{id:"项目中引入liquibase"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#项目中引入liquibase","aria-hidden":"true"}},[a._v("#")]),a._v(" 项目中引入liquibase")]),a._v(" "),n("p",[a._v("实际项目中大多数情况是数据库已经存在，需要做扩展升级。这时候可以手动把当前数据库进行liquibase备份，然后项目中引入。")]),a._v(" "),n("ul",[n("li",[a._v("下载liquibase解压到本地"),n("br"),a._v(" "),n("a",{attrs:{href:"https://download.liquibase.org/download/?frm=n",target:"_blank",rel:"noopener noreferrer"}},[a._v("下载地址"),n("OutboundLink")],1),a._v(",注意下图中是我已包含数据库驱动和生成的配置文件。"),n("br"),a._v(" "),n("img",{attrs:{src:t(255),alt:"reales"}})]),a._v(" "),n("li",[a._v("添加数据库驱动生成备份配置"),n("br"),a._v("\n把mysql-connector-java-5.1.38-bin.jar拷贝到文件夹内，cmd进入当前文件夹，执行生成脚本。"),n("br"),a._v("\n数据库结构生成init-table.xml")])]),a._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v('liquibase --driver=com.mysql.jdbc.Driver --classpath=mysql-connector-java-5.1.38-bin.jar --changeLogFile=./init-table.xml --url="jdbc:mysql://localhost:3306/jiay" --username=root --password=jc1 generateChangeLog\n')])])]),n("p",[a._v("数据库数据生成init-data.xml")]),a._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v('liquibase --driver=com.mysql.jdbc.Driver --classpath=mysql-connector-java-5.1.38-bin.jar --changeLogFile=./init-data.xml --url="jdbc:mysql://localhost:3306/jiay?zeroDateTimeBehavior=convertToNull&useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai&autoReconnect=true" --username=root --password=jc1 --diffTypes=data generateChangeLog\n')])])]),n("ul",[n("li",[a._v("引入项目"),n("br"),a._v("\ninit-table.xml和init-data.xml拷贝到liquibase文件夹内，然后就可以在changelog-master.xml中选则是否包含配置进行升级了。")])]),a._v(" "),n("h2",{attrs:{id:"示例源码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#示例源码","aria-hidden":"true"}},[a._v("#")]),a._v(" 示例源码")]),a._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/Gladitor/liquibasedemo",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://github.com/Gladitor/liquibasedemo"),n("OutboundLink")],1)]),a._v(" "),n("h2",{attrs:{id:"欢迎来访"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#欢迎来访","aria-hidden":"true"}},[a._v("#")]),a._v(" 欢迎来访")]),a._v(" "),n("ul",[n("li",[a._v("有问题欢迎留言或加交流qq群:934022738")]),a._v(" "),n("li",[a._v("请小编喝茶~")])]),a._v(" "),n("p",[n("img",{attrs:{src:t(113),alt:"wx"}})]),a._v(" "),n("Vssue",{attrs:{title:"liquibasedemo"}})],1)},[],!1,null,null,null);e.default=r.exports}}]);